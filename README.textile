h1. rah_function

p. Every function is a @<txp:tag />@. Rah_function allows you to call any PHP function in Textpattern's tag syntax. No need for PHP snippets, ending nor closing PHP tags -- only thing you need is a XML like tag.

h2. List of features

* Call any PHP function with a single TXP tag.
* Freely use function's attributes, flags and parameters.
* Supports both, a container and a single tag format.

h2. Requirements

* Textpattern 4.0.7 or newer.

h2. Installation

p. Rah_function's installation follows the usual standard plugin installation steps.

# Download the plugin installation code.
# Copy and paste installation code into your Textpattern installation's Plugin pane's "Install plugin" box.
# Run the automated setup.
# After the setup is done, activate the plugin. Done.

p. The plugin respects Textpattern's scripting preferences. After installation make sure that you have allowed PHP scripting:

# Go to Textpattern's Advanced Preferences (Textpattern > Admin > Preferences > Advanced).
# Toggle allow on PHP scripting for Pages and Articles (or for where you want to use the plugin).

h2. Attributes

p. The tag is @<txp:rah_function />@ and attributes for it follow.

p. *call*
The name of the function you want to use with the tag. This attribute is required.
Example: @call="base64_encode"@ Default: @""@

p. *thing*
With thing you can choose the argument place for container mode's contained statement. For example, if @thing="here"@ is the last defined attribute in the tag, then the contained statement is used as the last argument too for the PHP function. If @thing@ is left undefined, contained statement is used as the first argument.
Example: @foo="bar" thing="here" bar="foo"@ Default: _undefined_.

p. *parameter1,parameter2,parameter3,[..]*
Can be anything. All parameters are passed to the called function. Arguments are assigned to the function in the order they are defined.
Example: @foo2="bar" foo1="bar" foo4="bar"@ Default: _undefined_.

h2. Using the tag

p. The tag, @<txp:rah_function />@ supports a container tag usage. If the tag is used in a container format, the contained statement/code is used as:

* In the argument place that chosen with @thing="here"@ attribute. See _List of attributes_ and _Examples_ for more information.
* If @thing@ is left undefined, contained statement is used as the function's first argument.

p. If the tag is used in a self-closing format, then the contained statement is not used (apparently) and the tag works just with the attributes you set.

p. All attributes that are used inside the tag are assigned to the called function in the order they are defined. If no attributes are used, except the mandatory @call@, then the function is used as is with no arguments.

h2. Examples

h3. Basic usage of base64_encode as a container

bc. <txp:rah_function call="base64_encode">
	Hello world!
</txp:rah_function>

p. Returns base64 encoded string: @DQoJSGVsbG8gd29ybGQhDQo=@

h3. Replacing content using str_replace in a single tag mode

bc. <txp:rah_function call="str_replace" search="Hello" replace="Hi" subject="Hello world!" />

p. Returns: @Hi world!@

h3. Replacing content using str_replace and containers

p. Contained statement is used as "str_replace":http://php.net/manual/en/function.str-replace.php's _subject_ parameter. Wrapped content is positioned to correct location by using @thing="here"@ in the tag.

bc. <txp:rah_function call="str_replace" search="Hello" replace="Hi" thing="here">
	Hello world!
</txp:rah_function>

p. Returns: @Hi world!@

h3. Sanitizing and returning HTTP GET value

p. Returning GET/POST values and sanitizing the output can be done with a single rah_function tag instance by using plugin's multi-function call feature. First we would use Textpattern's @gps@ function to get a specific value, e.g. @theme@, and then prepare it for the page template by converting HTML's special characters to entities with "htmlspecialchars":http://php.net/manual/en/function.htmlspecialchars.php.

bc. <txp:rah_function call="gps, htmlspecialchars" name="theme" />

p. Above would return HTTP GET/POST param's, named @theme@, value. If requested value is @?theme=I<3TXP@, above would return safe string of @I&lt;3TXP@.

h3. Removing appending and prepending whitespace or other characters

p. Wrapped content is passed to "trim":http://php.net/manual/en/function.trim.php function, which is set to strip @H@ characters from the beginning and the end.

bc. <txp:rah_function call="trim" charlist="H">
	Hello world!
</txp:rah_function>

p. Returns: @ello world!@

h3. Returning time using safe_strftime()

bc. <txp:rah_function call="safe_strftime">
	%Y
</txp:rah_function>

p. Returns: @2009@.

h3. Fetching a single field from the database with fetch() function

bc. <txp:rah_function call="fetch" what="last_access" from="txp_users" where="user_id" is="1" />

Returns: Last access time for site admin with user ID of 1.

h3. Counting the amount of articles in the current section

p. Counting is done with Textpattern's @safe_count()@ function.

bc. <txp:rah_function call="safe_count" table="textpattern" where='Section="<txp:section />"' />

Returns: number of articles.

h2. Changelog

h3. Version 0.5 - upcoming

* Added: Multiple functions can be called with a single tag instance (@call="func1, func2, func3"@). Output is passed by reference from function to function. First function in the list is treated as the primary and given tag attributes only apply to it.
* Added: Arrays are returned as serialized string and can be passed from one tag instance to other. Serialized output can be extracted by prefixing used tag attribute name with @_serialized@.
* Added: Converts returned booleans to uppercase strings, @TRUE@ and @FALSE@. This makes it possible to identify integers from booleans (e.g. strpos).
* Added: Return arrays as serialized strings.
* Improved: Prevent passing non-scalars to the template.
* Improved: Moved away from sanitization and @eval()@.
* Improved: Show some error messages when needed.
* Updated: Code structure.
* Updated: Help file (readme).

h3. Version 0.4 - 2011/12/16

* Improved: Do not use attributes' real names in the function call, but use an temp array. Makes sure attributes get resolved as valid variables no matter what is passed by Textpattern's parser to the plugin.

h3. Version 0.3 - 2011/07/08

* Fixed: Now empty, nothing-at-all, string can be used as the container-mode's wrapped statement.
* Added: Now makes sure that the called function is really defined before executing anything.

h3. Version 0.2 - 2009/11/28

* Added attribute: @thing@. Thanks you "Ruud":http://forum.textpattern.com/viewtopic.php?pid=220042#p220042 for the suggestion.

h3. Version 0.1.1 - 2009/11/21

* Added @has_privs()@ and @allow_scripting@ checks.

h3. Version 0.1 - 2009/11/21

* First release